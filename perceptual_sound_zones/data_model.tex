\section{Data Model}
\label{sec:data_model}
\todo{CITATION NEEDED, I have not cited anything. Probably should?}
In this section the base data model will be introduced.
This data model will be later used in the derivation of the sound zone algorithms.

Firstly, in \autoref{sec:data_model:room_model} a spatial description of a room will be given.
This description will include the the contents of the room, namely the zones and loudspeakers contained within.
Finally, after introducing the room, the sound zone problem can be more formally defined.


\subsection{Room Model and Sound Zone Problem Statement}
\label{sec:data_model:room_model}
\todo{I am not great at topology, so I would love some tips on how to write this down in a better way...}
In this section, a description of the room in which sound zones are to be reproduced will be given.
In general, the room can contain any number of zones, but this thesis will focus on the two zone case 
(the work can however be extended to a larger number of zones).
This description can then be used to pose the sound zone problem in a more formal way.

In general, the room $R$ can be modeled as a closed subset of three dimensional space, $\mathcal{R} \subset \Real{3}$.
The two non-overlapping zones $\za$ and $\zb$ are contained within the room $R$, 
i.e. $\za \subset \mathcal{R}$ and $\zb \subset \mathcal{R}$ where $\za \cap \zb = \emptyset$.
In addition to the zones, the room $\mathcal{R}$ also contains $N_L$ loudspeakers, which can be modeled as discrete points.

\begin{figure}[htb]
    \centering
    \input{tikz/tikz_3D_room_data_model.tex}
\end{figure}

The goal of the sound zone algorithm is to use the loudspeakers to realise a specified target sound pressure
in the space defined by zones $\za$ and $\zb$.
This is to be done in such a way that there is minimal interference between zones; 
meaning that target sound pressure intended zone should not be audible in the other zones.
The loudspeakers can be controlled by specifying their input signals.
As such, the goal of the sound zone algorithm can be reframed as finding loudspeaker input signals such that a specified target sound pressure is attained.

The rest of this section will focus on formalizing this notion mathematically.
First, a way of modeling the target sound pressure will be discussed.
Afterwards, a way of realizing said target sound pressure by controlling the loudspeaker inputs will be given mathematically.
Finally, the data model is used to state the goal of the sound zone algorithm more formally.

\subsubsection{Defining Target Sound Pressure}
As mentioned, the goal of the sound zone algorithm is to realize a specified target sound pressure
in the different zones $\za$ and $\zb$ in the room $R$.

The zones are given as continious regions in space.
Some sound zone approach will attempt to recreate a specified pressure in the entire region of space defined by $\za$ and $\zb$.
Other sound zone approaches will instead discretize the zones into so-called control points.
The sound pressure is then controlled only in these control points.

In this work, the latter approach will be taken.
\todo{Why does discretizing make sense? Add more reasons...}
Thus, we discretize zones $\za$ and $\zb$ into a total of $N_a$ and $N_b$ control points respectively.   
Let $A$ and $B$ denote the sets of the resulting control points points contained within zones $\za$ and $\zb$ respectively.

\todo{Update the previously introduced graphic to include the control points}

Now let $t^{m}[n]$ denote the target sound pressure at control point $m$ in either $A$ or $B$, i.e. $m\in A \cup B$.
Our goal is thus to realize $t^{m}[n]$ in all control points $m\in A \cup B$ using the loudspeakers present in the room.
The relationship between the loudspeaker input signals and the sound pressure is the topic of the next section.

\subsubsection{Realizing Sound Pressure through the Loudspeaker}
The sound pressure produced by the loudspeakers can be controlled by specifying their input signals.
Mathematically speaking, let $x_l[n]\in\Real{N_x}$ denote the loudspeaker input signal for the $l^\text{th}$ loudspeaker.
As such, the goal of the sound zone algorithm is to find loudspeaker inputs $x_l[n]$ 
such that the target sound pressure $t^{m}[n]$ is realized for all $m\in A \cup B$.

In order to do so, a relationship must be established between the loudspeaker inputs $x_l[n]$
and the resulting sound pressure at control points $m\in A \cup B$. 
This relationship can be modeled by room impulse responses (RIRs) $h^{(l,m)[n]}\in\Real{N_h}$.

The RIRs $h^{(l,m)[n]}$ determines what sound pressure is realized at control point $m$ due to playing loudspeaker signal $x_l[n]$. 
Mathematically, let $p^{(l,m)[n]}\in\Real{N_x + N_h - 1}$ represent the realised sound pressure in control point $m$
due to playing from loudspeaker $l$.
\begin{equation}
    p^{(l,m)}[n] = \left(h^{(l,m)} \ast x_l\right)[n]
\end{equation}
The realised sound pressure $p^{(l,m)[n]}$ only considers the contribution of loudspeaker $l$ at reproduction point $m$.
Let $p^{(l)}[n]\in\Real{N_x + N_h - 1}$ denote the total sound pressure due to all $N_L$ loudspeakers.
It can now be expressed as the sum over all contributions as follows: 
\begin{align}
    p^{(m)}[n] &= \sum_{l=0}^{N_L} p^{(l,m)}[n] \\
               &= \sum_{l=0}^{N_L} \left(h^{(l,m)} \ast x_l\right)[n]
\end{align}

\subsubsection{Sound Zone Problem Statement}
With this data model is complete and the goal of the sound zone algorithm can be restated.
Namely, the goal is to find $x_l[n]$ such that the realised sound pressure $p^{(m)}[n]$ attains the
target sound pressure $t^{(m)}[n]$ for all control points $m\in A \cup B$.

The rest of \autoref{sec:data_model} will describe how this problem can be solved in greater detail.
First, \autoref{sec:data_model:target_pressure_choice} discusses how the target sound pressure will be chosen.
Afterwards, \autoref{sec:data_model:pressure_matching} will discuss the Pressure Matching (PM) approach 
that can be used to solve the stated sound zone problem. 
This approach will form the foundation on which the perceptual sound zone algorithms will be constructed.

\subsection{Choice of Target Pressure}
\label{sec:data_model:target_pressure_choice}
So far, the choice of target sound pressure $t^{(m)}[n]$ has been kept general. 
In this section, a choice for the target pressure will be made and motivated.

The target sound pressure $t^{(m)}[n]$ describes the desired content for a specific control point $m$. 
Assume that the user of the sound zone system has selected loudspeaker input signals $s_\za[n]\in\Real{N_x}$ and
$s_\zb[n]\in\Real{N_x}$ that they intend to hear in zone $\za$ and $\zb$ respectively.

In order to accomodate the wishes of the user, the target sound pressure is chosen as follows: 
\begin{align}
    t^{(m)}[n] = \sum_{l=0}^{N_L} \left(h^{(l,m)} \ast s_\za\right)[n]\qquad &\forall\,m\in A\\
    t^{(m)}[n] = \sum_{l=0}^{N_L} \left(h^{(l,m)} \ast s_\zb\right)[n]\qquad &\forall\,m\in B
\end{align}
This choice for target sound pressure can be understood as the sound pressure that results when playing the
selected loudspeaker input signals $s_\za[n]$ and $s_\zb[n]$ seperately using the loudspeakers.
For example, when in zone $A$, the target sound pressure is set equal to the sound pressure corresponding to playing only $s_\za[n]$ from the loudspeakers.
Similarly, when in zone $B$, the target sound pressure is set to the pressure that arises from playing only $s_\zb[n]$.

The motivation for choosing this target is that it physically attainable with the given loudspeakers and room.
\todo{Expand this motivation with a couple more arguments.}

\subsection{Multi-Zone Pressure Matching Solution Approach}
\label{sec:data_model:pressure_matching}
The ``Pressure Matching'' (PM) is widely used in literature to solve the sound zone problem.
In this section, a ``Multi-Zone Pressure Matching'' (MZ-PM) algorithm will be derived.
The motivation for discussing it is that it will be used as the foundation on which the perceptual sound zone algorithm will be built, 
as it was found that perceptual information was easily intergratable into the pressure matching framework.
\todo{Expand this motivation with a couple more arguments...?}

In the typical PM approach, the resulting loudspeaker input signals $x_l[n]$ are determined for just a single zone.
If the solution for multiple zones is desired, than multiple PM problems must be solved and their resulting loudspeaker input signals combined. 
In the MZ-PM approach, the loudspeaker input signals are instead determined for jointly for all zones.

In a two zone approach, the loudspeaker input signals are decomposed into two parts as follows:
\begin{equation}
    x_l[n] = x_{l,\za}[n] + x_{l,\zb}[n]
\end{equation}
Here, $x_{l,\za}[n]$ and $x_{l,\zb}[n]$ are the parts of the loudspeaker input signal responsible for reproducing the target sound pressure 
in zone $\za$ and $\zb$ respectively.
Now, it is possible to consider the sound pressure that arises due to the seperate loudspeaker input signals:
\begin{align}
    p_\za^{(m)}[n] &= \sum_{l=0}^{N_L} \left(h^{(l,m)} \ast x_{l,\za}\right)[n] \\
    p_\zb^{(m)}[n] &= \sum_{l=0}^{N_L} \left(h^{(l,m)} \ast x_{l,\zb}\right)[n]
\end{align}
Here, $p_\za^{(m)}[n]$ and $p_\zb^{(m)}[n]$ can be understood to be the pressure that arrises due to 
playing loudspeaker input signals $x_{l,\za}[n]$ and $x_{l,\zb}[n]$ respectively. 

The idea in this approach is to chose $x_{l,\za}[n]$ and such that the resulting pressure $p_\za^{(m)}[n]$ attains the target sound pressure $t^{(m)}[n]$ in all $m \in A$.   
At the same time however, $p_\za^{(m)}[n]$ should not attain any sound pressure in all $m \in B$.
Any sound pressure resulting from $x_{l,\za}[n]$ in zone $\zb$ is essentially leakage or cross-talk between zones. 
Similar arguments can be given for $x_{l,\zb}[n]$: it should reproduce the target sound pressure for $m \in B$ but no sound pressure for $m \in A$. 

In the MZ-PM approach, the loudspeaker weights $x_{l,\za}[n]$ and $x_{l,\zb}[n]$ that achieve this goal are found by 
minimizing the difference between the intended pressure and the realized pressure as follows:

\begin{align}
    \argmin{x_{l,\za}[n],\,x_{l,\zb}[n]\,\forall\,l}{
       &\sum_{m\in A} \norm[2][2]{p_\za^{(m)}[n] - t^{(m)}[n]} +
        \sum_{m\in A} \norm[2][2]{p_\zb^{(m)}[n]} + \\
       &\sum_{m\in B} \norm[2][2]{p_\zb^{(m)}[n] - t^{(m)}[n]} + 
        \sum_{m\in B} \norm[2][2]{p_\za^{(m)}[n]}
    }
\end{align}

Here, the first two terms can be understood as the reproduction error and the leakage for zone $\za$.
Similarly, the last two terms are the reproduciton error and leakage for zone $\zb$. 
Typically, this approach results in trade-off between minimizing the reproduction errors and leakages. 
Some pressure matching approaches attempt to control this trade-off by introducing weights for the different error terms, or constraints.

The problem can be solved in the time and the frequency domain.
In frequency domain approaches, the convolutions become inner products, which typically results in a lower computational complexity.

The algorithm above will form the basis of the perceptual algorithms to be introdued in the following sections.
